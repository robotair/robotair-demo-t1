name: Deploy ROS application ðŸš€

on:

  push:
    branches:
    
      - main
    
      - master
    
  pull_request:
    branches:
    
      - main
    
      - master
    

jobs:

  robotair:

    name: Deploy ROS application
    runs-on: ubuntu-latest

    steps:

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Export repository secrets as environment variables
        uses: oNaiPs/secrets-to-env-action@v1.4
        with:
          secrets: ${{ toJSON(secrets) }}
      
      - name: Install Rigel
        run: |
          wget -O - https://apt.robotair.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/robotair.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/robotair.gpg] https://apt.robotair.io stable main" | sudo tee /etc/apt/sources.list.d/robotair.list
          sudo apt update && sudo apt install -y rigel

      - name: Deploy ROS application using Rigel
        run: rigel run sequence robotair